package com.oracle;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.Statement;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Map;
import java.util.Set;

/**
 * Created by sshil on 7/26/2016.
 */
public class FacilityMapping {
    public static final String DSVS = "522123,267750,270058,24302,349295,450361,41243,242206,404041,472184,538801,172580,482995,455709,\n" +
        "533075,291500,519322,57474,414875,215411,261092,414560,175257,274893,530188,53590,51903,450734,\n" +
        "466863,232073,264153,9167,456673,9399,464581,9696,166222,23804,268194,224071,511873,524256,210123,\n" +
        "261593,261284,30085,451253,490535,451930,19251,232341,224264,232162,228163,537210,516743,420324,\n" +
        "469270,336586,40238,397612,97684,520192,453830,268244,60202,441030,537816,220699,48785,57932,54101,\n" +
        "33931,409483,19299,360297,72041,144204,152009,424815,92681,446310,319657,151134,267911,415174,462866,\n" +
        "14674,119826,17621,13992,510818,283747,185371,481358,438112,353004,105999,14285,338301,422662,428235,\n" +
        "117635,297072,362541,448878,388642,444096,205567,152230,73445,270794,349772,468731,474346,182568,\n" +
        "429241,211698,225474,5632,333432,415870,13801,251405,299142,437023,208751,151779,295758,415455,\n" +
        "468350,100680,390792,533223,122663,40055,395841,487624,424556,131540,297064,320700,14818,465831,\n" +
        "476812,199844,256233,455501,514203,489922,79512,463862,212001,527254,411546,485283,525733,348370,\n" +
        "536516,386763,261198,330639,477183,232903,457317,19433,205453,466972,357988,212592,95052,457002,\n" +
        "272831,408392,258657,363130,228643,447490,446620,437742,9681,466964,487552,211636,515143,270053,\n" +
        "8870,520056,364961,182006,453111,272112,151761,54733,477122,45404,236240,109465,297416,542792,543426,\n" +
        "543942,546450,547003,547045,549203,549568,555584,556506,557653,558502,566638,588723,604132,608893,\n" +
        "614542,616683,617410,619992,631531,631838,643205,656034,657582,658271,665102,670882,673736,674135,\n" +
        "674155,678495,688973,707882,727763,728583,729981,731356,731565,731893,731932,732958,735055,735105,\n" +
        "735290,736434,736465,736835,738013,739055,739485,739733,740217,755931,755952,756083,813113,856034,\n" +
        "867200,883982,902189,916702,916703,916704,956987,967174,968818,4167301,4167302,4167303,10946501,10946502,\n" +
        "10946503,17870001,17870002,17870003,17870004,17870005,17870006,17870007,17870008,17870009,17870010,17870011,\n" +
        "23207302,25170201,25865703,26512301,26512302,26512303,26512304,26512305,26512306,26512307,26512308,26512309,\n" +
        "26512310,26512311,26512312,26512313,27079402,27079403,35798802,37360501,37360502,45581601,45581602,\n" +
        "50453501,50453502,50453503,50453504,50453505,50453506,50453507,61710502,66510202,66510204,66510205,66510206,\n" +
        "66510207,73643401,73643402,73643403,73643404,75560401,227794061,232145470,730450690,888880009,\n" +
        "236943,218727,49380,441290,414078,140660,234336,200973,512912,34764,420117,53244,535872,483781,455140,\n" +
        "144675,441823,52780,243454,336474,291377,472766,255653,5580,473215,430785,61859,492283,254552,498456,\n" +
        "463252,478313,483693,422266,121681,46030,521666,446883,385005,447103,448035,436253,195461,49973,490933,8979,434501,\n" +
        "221401,505656,144013,477904,20266,295413,480395,503771,52962,226972,737,385401,502824,420912,\n" +
        "8789,299403,484279,4245,57174,170605,138151,470187,455892,533422,484173,263434,452842,33780,\n" +
        "446562,514942,263376,453994,413992,503946,473785,439794,260976,474935,494873,358734,38490,337204,\n" +
        "479462,439781,462142,477551,466812,512973,39511,522572,479342,529502,338054,414782,480932,451187,\n" +
        "23114,224543,505704,85612,262444,53660,13441,472343,238428,233331,486333,422342,257773,467626,483941,\n" +
        "488291,15728,504394,258848,419643,9321,422365,260414,454900,454371,486602,259890,516632,487794,525983,\n" +
        "480616,516230,357343,485584,450106,258132,480623,475080,514273,467491,486043,416122,251736,204537,\n" +
        "448152,392412,428141,535115,501402,22921,524523,451851,420323,49262,512087,286745,471915,274514,321653,\n" +
        "271242,502271,471156,520148,306845,472891,450822,487465,252642,432914,534909,482497,466764,461926,261235,\n" +
        "263551,192500,519579,275744,420223,514474,484113,36996,52814,492256,451982,171921,213592,395954,481408,\n" +
        "372540,366042,444284,255521,496695,53653,479811,257403,258640,449363,477489,517482,12254,73668,392951,\n" +
        "448145,257571,89656,274493,166793,73702,460835,525758,199336,98046,516113,39433,347040,209908,24542,\n" +
        "243421,480280,265186,514673,473157,434969,56484,185124,470812,445143,176112,356,89433,502533,513317,\n" +
        "258541,404061,39452,230602,40292,308577,17871,167957,266620,525993,445171,485631,502863,192154,411632,\n" +
        "482755,305321,374702,255831,269402,514463,465005,187559,519871,511710,212451,51755,434865,448811,278101,\n" +
        "45014,470484,481572,230533,446602,480953,271072,411781,136874,512103,140913,285155,486436,487405,480983,\n" +
        "20146,237086,22381,488734,189308,433664,325196,542103,542752,542921,543453,543903,544834,544893,545566,545924,\n" +
        "546181,546382,552794,552828,553755,554165,554456,554514,555826,556103,556410,570200,580670,581273,609222,\n" +
        "613182,616584,616622,616735,616883,617399,624162,624263,638775,639483,655012,655541,658115,660754,665813,\n" +
        "673884,673926,675678,722101,729186,729593,729660,731211,731534,731596,732492,732495,732821,735738,736333,\n" +
        "738633,738666,739714,743351,751867,754583,754801,755424,755483,755552,755642,783159,792226,821389,840777,\n" +
        "843839,870881,895144,911867,933635,970657,990259,992719,1928101,1928102,1928103,3676401,3676402,3676403,3676404,\n" +
        "5175502,6185902,6185903,9228301,10930602,12168102,13687402,20371101,20371102,22748802,23125802,26057301,26097602,\n" +
        "26505301,27306301,27306302,27306309,27416702,28793301,30089701,30429501,34179301,40404102,40404103,40575301,\n" +
        "41354501,41354502,43162001,43162002,43162003,43162004,43162005,43162006,43430801,43842302,43842303,44369701,\n" +
        "44512201,44512202,44781302,45199701,45258101,45389301,45389302,45438201,46078501,46078502,46252401,46629502,\n" +
        "47048402,47048403,47290301,47397502,47929201,47929202,48039502,48417302,48417303,49093302,49487302,51501501,\n" +
        "51564301,52317501,53550001,53550002,54519401,54782801,65974102,66362202,67543901,67543902,73153402,73153403,\n" +
        "73801302,73966101,74339401,74339402,75542402,75618202,82138902,84383902,96717402,888880004,888880006,888880007,\n" +
        "888880008,888880014,888880015,888880016,888880017,888880019,888880020,888880021,888880023,888880024,888880026,\n" +
        "888880031,888880032,888880033,888880034,888880035,888880036,888880038,888880039,888880040,888880041,888880044,\n" +
        "888880047,888880050,888880057,888880059,888880060,888880061,888880065,888880067,888880073,888880075,888880076,\n" +
        "888880077,888880078,888880081,888880082,888880086,888880087,888880093,888880094,888880097,888880098,888880100,888880101";

    private static final String SQL = "select * from wfu_message_type_trans where message_type in (select message_type from wfu_message_types where distributor_id in (522123,267750,270058,24302,349295,450361,41243,242206,404041,472184,538801,172580,482995,455709,\n" +
        "533075,291500,519322,57474,414875,215411,261092,414560,175257,274893,530188,53590,51903,450734,\n" +
        "466863,232073,264153,9167,456673,9399,464581,9696,166222,23804,268194,224071,511873,524256,210123,\n" +
        "261593,261284,30085,451253,490535,451930,19251,232341,224264,232162,228163,537210,516743,420324,\n" +
        "469270,336586,40238,397612,97684,520192,453830,268244,60202,441030,537816,220699,48785,57932,54101,\n" +
        "33931,409483,19299,360297,72041,144204,152009,424815,92681,446310,319657,151134,267911,415174,462866,\n" +
        "14674,119826,17621,13992,510818,283747,185371,481358,438112,353004,105999,14285,338301,422662,428235,\n" +
        "117635,297072,362541,448878,388642,444096,205567,152230,73445,270794,349772,468731,474346,182568,\n" +
        "429241,211698,225474,5632,333432,415870,13801,251405,299142,437023,208751,151779,295758,415455,\n" +
        "468350,100680,390792,533223,122663,40055,395841,487624,424556,131540,297064,320700,14818,465831,\n" +
        "476812,199844,256233,455501,514203,489922,79512,463862,212001,527254,411546,485283,525733,348370,\n" +
        "536516,386763,261198,330639,477183,232903,457317,19433,205453,466972,357988,212592,95052,457002,\n" +
        "272831,408392,258657,363130,228643,447490,446620,437742,9681,466964,487552,211636,515143,270053,\n" +
        "8870,520056,364961,182006,453111,272112,151761,54733,477122,45404,236240,109465,297416,542792,543426,\n" +
        "543942,546450,547003,547045,549203,549568,555584,556506,557653,558502,566638,588723,604132,608893,\n" +
        "614542,616683,617410,619992,631531,631838,643205,656034,657582,658271,665102,670882,673736,674135,\n" +
        "674155,678495,688973,707882,727763,728583,729981,731356,731565,731893,731932,732958,735055,735105,\n" +
        "735290,736434,736465,736835,738013,739055,739485,739733,740217,755931,755952,756083,813113,856034,\n" +
        "867200,883982,902189,916702,916703,916704,956987,967174,968818,4167301,4167302,4167303,10946501,10946502,\n" +
        "10946503,17870001,17870002,17870003,17870004,17870005,17870006,17870007,17870008,17870009,17870010,17870011,\n" +
        "23207302,25170201,25865703,26512301,26512302,26512303,26512304,26512305,26512306,26512307,26512308,26512309,\n" +
        "26512310,26512311,26512312,26512313,27079402,27079403,35798802,37360501,37360502,45581601,45581602,\n" +
        "50453501,50453502,50453503,50453504,50453505,50453506,50453507,61710502,66510202,66510204,66510205,66510206,\n" +
        "66510207,73643401,73643402,73643403,73643404,75560401,227794061,232145470,730450690,888880009, \n" +
        "236943,218727,49380,441290,414078,140660,234336,200973,512912,34764,420117,53244,535872,483781,455140,\n" +
        "144675,441823,52780,243454,336474,291377,472766,255653,5580,473215,430785,61859,492283,254552,498456,\n" +
        "463252,478313,483693,422266,121681,46030,521666,446883,385005,447103,448035,436253,195461,49973,490933,8979,434501,\n" +
        "221401,505656,144013,477904,20266,295413,480395,503771,52962,226972,737,385401,502824,420912,\n" +
        "8789,299403,484279,4245,57174,170605,138151,470187,455892,533422,484173,263434,452842,33780,\n" +
        "446562,514942,263376,453994,413992,503946,473785,439794,260976,474935,494873,358734,38490,337204,\n" +
        "479462,439781,462142,477551,466812,512973,39511,522572,479342,529502,338054,414782,480932,451187,\n" +
        "23114,224543,505704,85612,262444,53660,13441,472343,238428,233331,486333,422342,257773,467626,483941,\n" +
        "488291,15728,504394,258848,419643,9321,422365,260414,454900,454371,486602,259890,516632,487794,525983,\n" +
        "480616,516230,357343,485584,450106,258132,480623,475080,514273,467491,486043,416122,251736,204537,\n" +
        "448152,392412,428141,535115,501402,22921,524523,451851,420323,49262,512087,286745,471915,274514,321653,\n" +
        "271242,502271,471156,520148,306845,472891,450822,487465,252642,432914,534909,482497,466764,461926,261235,\n" +
        "263551,192500,519579,275744,420223,514474,484113,36996,52814,492256,451982,171921,213592,395954,481408,\n" +
        "372540,366042,444284,255521,496695,53653,479811,257403,258640,449363,477489,517482,12254,73668,392951,\n" +
        "448145,257571,89656,274493,166793,73702,460835,525758,199336,98046,516113,39433,347040,209908,24542,\n" +
        "243421,480280,265186,514673,473157,434969,56484,185124,470812,445143,176112,356,89433,502533,513317,\n" +
        "258541,404061,39452,230602,40292,308577,17871,167957,266620,525993,445171,485631,502863,192154,411632,\n" +
        "482755,305321,374702,255831,269402,514463,465005,187559,519871,511710,212451,51755,434865,448811,278101,\n" +
        "45014,470484,481572,230533,446602,480953,271072,411781,136874,512103,140913,285155,486436,487405,480983,\n" +
        "20146,237086,22381,488734,189308,433664,325196,542103,542752,542921,543453,543903,544834,544893,545566,545924,\n" +
        "546181,546382,552794,552828,553755,554165,554456,554514,555826,556103,556410,570200,580670,581273,609222,\n" +
        "613182,616584,616622,616735,616883,617399,624162,624263,638775,639483,655012,655541,658115,660754,665813,\n" +
        "673884,673926,675678,722101,729186,729593,729660,731211,731534,731596,732492,732495,732821,735738,736333,\n" +
        "738633,738666,739714,743351,751867,754583,754801,755424,755483,755552,755642,783159,792226,821389,840777,\n" +
        "843839,870881,895144,911867,933635,970657,990259,992719,1928101,1928102,1928103,3676401,3676402,3676403,3676404,\n" +
        "5175502,6185902,6185903,9228301,10930602,12168102,13687402,20371101,20371102,22748802,23125802,26057301,26097602\n" +
        ",26505301,27306301,27306302,27306309,27416702,28793301,30089701,30429501,34179301,40404102,40404103,40575301,\n" +
        "41354501,41354502,43162001,43162002,43162003,43162004,43162005,43162006,43430801,43842302,43842303,44369701,\n" +
        "44512201,44512202,44781302,45199701,45258101,45389301,45389302,45438201,46078501,46078502,46252401,46629502,\n" +
        "47048402,47048403,47290301,47397502,47929201,47929202,48039502,48417302,48417303,49093302,49487302,51501501,\n" +
        "51564301,52317501,53550001,53550002,54519401,54782801,65974102,66362202,67543901,67543902,73153402,73153403,\n" +
        "73801302,73966101,74339401,74339402,75542402,75618202,82138902,84383902,96717402,888880004,888880006,888880007,\n" +
        "888880008,888880014,888880015,888880016,888880017,888880019,888880020,888880021,888880023,888880024,888880026,\n" +
        "888880031,888880032,888880033,888880034,888880035,888880036,888880038,888880039,888880040,888880041,888880044,\n" +
        "888880047,888880050,888880057,888880059,888880060,888880061,888880065,888880067,888880073,888880075,888880076,\n" +
        "888880077,888880078,888880081,888880082,888880086,888880087,888880093,888880094,888880097,888880098,888880100,888880101) and IS_INBOUND='N');\n";

    public static void main(String[] args) {
        try {
            String[] arr = DSVS.split(",");
            Set<String> dsvs = new HashSet<>();
            for (String str : arr){
                dsvs.add(str);
            }
            String str = String.join(",", dsvs);
            String dbURL = "jdbc:oracle:thin:@(DESCRIPTION=(ADDRESS_LIST=(ADDRESS=(PROTOCOL=TCP)(HOST=ndc-vedip1.walmart.com)(PORT=1521)))(CONNECT_DATA=(SERVICE_NAME=edip1)))";
            String strUserID = "integration_user";
            String strPassword = "intgrt10n1";
            Connection myConnection= DriverManager.getConnection(dbURL, strUserID, strPassword);

            Map<String, String> map = new HashMap<>();
            Statement sqlStatement = myConnection.createStatement();
            String readRecordSQL = "select * from wfu_message_type_trans where message_type in (select message_type from wfu_message_types where distributor_id in ("+str+") and IS_INBOUND='N')";
            ResultSet myResultSet = sqlStatement.executeQuery(readRecordSQL);
            while (myResultSet.next()) {
                //System.out.println("Record values: " + myResultSet.getString("distributor_id"));
                String child = myResultSet.getString("MESSAGE_TYPE");
                String parent = myResultSet.getString("MESSAGE_TYPE_TRANS");
                map.put(child, parent);
            }
            myResultSet.close();
          //  myConnection.close();
            /*
            Map<String, String> filteredDSVs = new HashMap<>();
            //map.entrySet().stream().forEach(entry ->System.out.println(entry.getKey()+" "+entry.getValue()));
            map.entrySet().stream()
               .filter(entry -> dsvs.contains(entry.getKey()))
               .forEach(entry -> filteredDSVs.put(entry.getKey(), entry.getValue()));
             */
            StringBuilder stringBuilder = new StringBuilder();
            stringBuilder.append("<ROWDATA>\n");
            for (Map.Entry<String, String> entry : map.entrySet()) {
                readRecordSQL = "select DISTRIBUTOR_ID from wfu_message_types where message_type = "+entry.getKey();
                myResultSet = sqlStatement.executeQuery(readRecordSQL);
                String child = null;
                if (myResultSet.next()) {
                    child = myResultSet.getString("DISTRIBUTOR_ID");
                }
                myResultSet.close();

                readRecordSQL = "select DISTRIBUTOR_NAME from wfu_distributor where DISTRIBUTOR_ID = "+child;
                myResultSet = sqlStatement.executeQuery(readRecordSQL);
                String childName = null;
                if (myResultSet.next()) {
                    childName = myResultSet.getString("DISTRIBUTOR_NAME");
                }
                myResultSet.close();

                readRecordSQL = "select DISTRIBUTOR_ID from wfu_message_types where message_type = "+entry.getValue();
                myResultSet = sqlStatement.executeQuery(readRecordSQL);
                String parent = null;
                if (myResultSet.next()) {
                    parent = myResultSet.getString("DISTRIBUTOR_ID");
                }
                myResultSet.close();
                readRecordSQL = "select DISTRIBUTOR_NAME from wfu_distributor where DISTRIBUTOR_ID = "+parent;
                myResultSet = sqlStatement.executeQuery(readRecordSQL);
                String parentName = null;
                if (myResultSet.next()) {
                    parentName = myResultSet.getString("DISTRIBUTOR_NAME");
                }
                myResultSet.close();

                stringBuilder.append("<ROW>\n");
                stringBuilder.append("    <CHILD_ID>"+child+"</CHILD_ID>\n");
                stringBuilder.append("    <CHILD_NAME>"+childName+"</CHILD_NAME>\n");
                stringBuilder.append("    <PARENT_ID>"+parent+"</PARENT_ID>\n");
                stringBuilder.append("    <PARENT_NAME>"+parentName+"</PARENT_NAME>\n");
                stringBuilder.append("</ROW>\n");
            }
            stringBuilder.append("</ROWDATA>\n");
            System.out.println(stringBuilder.toString());
        } catch (Exception e) {
            System.out.println(e);
        }

    }

}
